/**
 * Version History Instrument
 * Constitutional transparency for reflection changes
 * Complete edit history with diff view
 */

import { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { History, Eye, RotateCcw, Clock, X } from 'lucide-react';\n\ninterface ReflectionVersion {\n  id: string;\n  timestamp: Date;\n  content: string;\n  deviceName: string;\n  changesSummary?: string;\n}\n\ninterface VersionHistoryInstrumentProps {\n  reflectionId: string;\n  versions: ReflectionVersion[];\n  currentVersion: string;\n  onRestore: (versionId: string) => void;\n  onClose: () => void;\n}\n\nexport function VersionHistoryInstrument({ reflectionId, versions, currentVersion, onRestore, onClose }: VersionHistoryInstrumentProps) {\n  const [selectedVersion, setSelectedVersion] = useState<ReflectionVersion | null>(null);\n  const [showDiff, setShowDiff] = useState(false);\n\n  return (\n    <div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} exit={{ opacity: 0, scale: 0.95 }} className=\"fixed inset-0 z-50 flex items-center justify-center p-8\" onClick={(e) => e.target === e.currentTarget && onDismiss()}>\n      <div className=\"absolute inset-0 bg-black/80 backdrop-blur-sm\" />\n      <div className=\"relative w-full max-w-5xl bg-[var(--color-surface-card)] border border-[var(--color-border-subtle)] rounded-2xl shadow-2xl max-h-[85vh] flex\">\n        {/* Timeline sidebar */}\n        <div className=\"w-80 border-r border-[var(--color-border-subtle)] flex flex-col\">\n          <div className=\"p-6 border-b border-[var(--color-border-subtle)]\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <History size={20} className=\"text-[var(--color-accent-gold)]\" />\n              <h3 className=\"font-semibold text-[var(--color-text-primary)]\">Version History</h3>\n            </div>\n            <p className=\"text-sm text-[var(--color-text-muted)]\">{versions.length} versions</p>\n          </div>\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-2\">\n            <AnimatePresence>\n              {versions.map((version, index) => (\n                <motion.button key={version.id} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} onClick={() => setSelectedVersion(version)} className={`w-full p-4 rounded-xl text-left transition-all ${\n                  selectedVersion?.id === version.id\n                    ? 'bg-[var(--color-accent-gold)]/10 border-2 border-[var(--color-accent-gold)]'\n                    : 'bg-[var(--color-surface-card)] border border-[var(--color-border-subtle)] hover:border-[var(--color-border-emphasis)]'\n                }`}>\n                  <div className=\"flex items-start justify-between mb-2\">\n                    <span className=\"text-xs text-[var(--color-text-muted)]\">\n                      {index === 0 ? 'Current' : `Version ${versions.length - index}`}\n                    </span>\n                    <Clock size={12} className=\"text-[var(--color-text-muted)]\" />\n                  </div>\n                  <div className=\"text-sm text-[var(--color-text-secondary)] mb-1\">\n                    {formatTimestamp(version.timestamp)}\n                  </div>\n                  <div className=\"text-xs text-[var(--color-text-muted)]\">\n                    {version.deviceName}\n                  </div>\n                </motion.button>\n              ))}\n            </AnimatePresence>\n          </div>\n        </div>\n\n        {/* Content panel */}\n        <div className=\"flex-1 flex flex-col\">\n          <div className=\"p-6 border-b border-[var(--color-border-subtle)] flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold text-[var(--color-text-primary)]\">Version Preview</h2>\n            <div className=\"flex gap-2\">\n              {selectedVersion && selectedVersion.content !== currentVersion && (\n                <button onClick={() => onRestore(selectedVersion.id)} className=\"px-4 py-2 rounded-xl bg-[var(--color-accent-gold)] text-[var(--color-text-inverse)] flex items-center gap-2\">\n                  <RotateCcw size={16} />Restore\n                </button>\n              )}\n              <button onClick={onClose} className=\"p-2 rounded-lg hover:bg-white/5\">\n                <X size={20} className=\"text-[var(--color-text-muted)]\" />\n              </button>\n            </div>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto p-6\">\n            {selectedVersion ? (\n              <div className=\"space-y-4\">\n                <div className=\"p-6 rounded-xl bg-[var(--color-surface-card)] border border-[var(--color-border-subtle)]\">\n                  <pre className=\"text-sm text-[var(--color-text-secondary)] whitespace-pre-wrap font-sans\">\n                    {selectedVersion.content}\n                  </pre>\n                </div>\n                {selectedVersion.changesSummary && (\n                  <div className=\"p-4 rounded-xl bg-[var(--color-accent-gold)]/5 border border-[var(--color-accent-gold)]/20 text-sm text-[var(--color-text-secondary)]\">\n                    {selectedVersion.changesSummary}\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"flex items-center justify-center h-full text-[var(--color-text-muted)]\">\n                <div className=\"text-center\">\n                  <Eye size={48} className=\"mx-auto mb-4 opacity-50\" />\n                  <p>Select a version to preview</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction formatTimestamp(date: Date): string {\n  return date.toLocaleString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' });\n}"

