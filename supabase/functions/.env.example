# Supabase Edge Functions Configuration
# Generated for The Mirror Platform

# =============================================================================
# Required Environment Variables
# =============================================================================

# Supabase Configuration
SUPABASE_URL=https://enfjnqfppfhofredyxyg.supabase.co
SUPABASE_ANON_KEY=your_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here

# Database Direct Connection (for migrations)
SUPABASE_DB_URL=postgresql://postgres:[PASSWORD]@db.enfjnqfppfhofredyxyg.supabase.co:5432/postgres

# External Services
MIRRORX_API_URL=https://your-mirrorx-engine.onrender.com
RESEND_API_KEY=re_your_resend_api_key_here
ADMIN_EMAIL=admin@themirrorplatform.online

# Webhook Security
WEBHOOK_SECRET=your_webhook_secret_here

# =============================================================================
# Edge Functions Deployment
# =============================================================================

# Deploy all functions:
# supabase functions deploy

# Deploy specific function:
# supabase functions deploy send-contact-notification

# =============================================================================
# Function Descriptions
# =============================================================================

# send-contact-notification
# - Triggers: contact_submissions INSERT
# - Purpose: Email notification when contact form submitted
# - Dependencies: Resend API

# process-reflection
# - Triggers: Manual via API call
# - Purpose: Save reflection and trigger AI processing
# - Dependencies: MirrorX AI Engine

# sync-user-profile
# - Triggers: auth.users INSERT (database trigger)
# - Purpose: Auto-create profile when user signs up
# - Dependencies: None

# broadcast-reflection
# - Triggers: reflections INSERT/UPDATE (database trigger)
# - Purpose: Realtime broadcasts for live updates
# - Dependencies: Supabase Realtime

# analytics-aggregator
# - Triggers: Cron schedule (daily)
# - Purpose: Compute analytics summaries
# - Dependencies: None

# cleanup-sessions
# - Triggers: Cron schedule (weekly)
# - Purpose: Remove old data for performance
# - Dependencies: None

# webhook-handler
# - Triggers: External webhooks
# - Purpose: Handle external service integrations
# - Dependencies: Webhook providers

# =============================================================================
# Cron Jobs Setup
# =============================================================================

# Daily analytics aggregation (runs at 2 AM UTC)
# supabase functions schedule analytics-aggregator --cron "0 2 * * *"

# Weekly cleanup (runs Sunday at 3 AM UTC)
# supabase functions schedule cleanup-sessions --cron "0 3 * * 0"
